<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Circular Conference Visualization</title>
    <meta name="description" content="Circular Conference Visualization">
    <!-- <link rel="stylesheet" href="main.css">
    <script src="math.js" type="text/javascript"></script>
-->
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

    <style>
        .container {
            float: left;
        }
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        html {
            height: 100%;
        }
    </style>

</head>
<body>
    
<input type="file" id="file_conference_data" accept=".txt">

<div class="container" id="chart1">
</div>


<button id="buttonEnterFields" style="position: absolute; top:100px; left:20px;" onclick="enterFields()">Enter A Conference</button>

    <script type="text/javascript" src="VisualizationHandler.js"></script>
    <script type="text/javascript" src="Conference.js"></script>
    
    <script>
        var selected_conf_index;
        /*
         * dataHandler
         *
         * Class used for any necessary data manipulation
         */
        class dataHandler {
            // no args necessary in creation of dataHandler obj as of yet
            constructor() {}
            
            grabConferenceData(input_file) {
                var file_lines = input_file.split('\n');
                
                var conference_data = [];
                
                var num_confs = parseInt(file_lines[0], 10);
                var confs_as_url = parseInt(file_lines[1], 10);
                var confs_as_manual = parseInt(file_lines[2]);
                console.log(num_confs, confs_as_url, confs_as_manual);
                
                for (var i = 3; i < 3 + confs_as_url; i++) {
                    console.log(file_lines[i]);
                }
                
                for (var j = 3+confs_as_url; j < 3+confs_as_url+confs_as_manual; j++) {
                    var split_line = file_lines[j].split(',');
                    
                    var conference = [];
                    for (var k = 0; k < split_line.length; k++) {
                        if (k <= 2) {
                            conference.push(split_line[k]);
                        } else {
                            conference.push(parseInt(split_line[k], 10));
                        }
                    }
                    conference_data.push(conference);
                }
                console.log(conference_data);
                return conference_data;
            }
    
            // converts date object to a number to 1 and 366 (considers leap years)
            convertDateToNum(now) {
                var start = new Date(now.getFullYear(), 0, 0);
                var diff = (now - start) + ((start.getTimezoneOffset() - now.getTimezoneOffset()) * 60 * 1000);
                var oneDay = 1000 * 60 * 60 * 24;
                var day = Math.round(diff / oneDay);
                console.log('Day of year: ' + day);
                return day;
            }
    
            // converts number from 1 to 366 (considering leap years) into a date object
            convertNumToDate(now, now_num) {
                var date = new Date(now.getFullYear(), 0); // initialize a date in `year-01-01`
                return new Date(date.setDate(now_num)); // add the number of days
            }
        }
        
        
        
        
        function showDetails(svg, document, conferences_handler, conference) {
            // new elements are added dynamically on conference visualization click. This means that objects
            // need to be deleted and re-added each time a new conference is clicked. This array and fo r loop
            //
            // handles conference descriptive element deletions
            var details_element_ids = ["conferenceName", "mainParagraph", "deleteButton"];
            for (var i = 0; i < details_element_ids.length; i++) {
                if (document.getElementById(details_element_ids[i])){
                    var elem = document.getElementById(details_element_ids[i]);
                    elem.remove();
                }
            }
    
            //create a new container that will appear on the left side of the screen
            var container2 = document.createElement("div");
            container2.setAttribute("style","float: left;");
            document.body.appendChild(container2);
    
            var container3 = document.createElement("div2");
            container3.setAttribute("style","float: absolute;");
            container3.style.position = "absolute";
            container3.style.left = 1025 + 'px';
            container3.style.top = 175 +'px';
            document.body.appendChild(container3);
    
            // Header element, will contain Conference Name
            var h1 = document.createElement('h1');
            h1.id = "conferenceName";
            h1.textContent = conference.conf_name;
            var left = document.clientWidth/2;
            var top = document.clientHeight/2;
            //h1.style.left = left;
            //h1.style.top = top;
            //h1.setAttribute("style", "position: left; z-index: 1; left: "+left+"; top: "+top+"; width:200px; height:20px;");
            //h1.style.zIndex = 1;
            container2.appendChild(h1);
            //container2.appendChild(h1);
    
            // Paragraph element, unknown what this will contain
            var p1 = document.createElement('p1');
            p1.id = "mainParagraph";
            p1.setAttribute("style", "position: absolute; z-index: 1; left: "+left+"; top: "+top+"; width:190px; height:100px;");
            p1.textContent = "Conference Topic: " + conference.conf_field + "\r\nLocation: " + conference.conf_location + "\r\nSubmission Deadline: " + conference.submission_deadline + "\r\nNotification Deadline: " + conference.notification_deadline + "\r\nFinal Version Due: " + conference.decision_deadline;
            p1.setAttribute('class', 'note');
            p1.setAttribute('vertical-align', 'baseline');
            container2.appendChild(p1);
    
            var deleteButton = document.createElement("button");
            deleteButton.innerHTML = "Delete Conference";
            deleteButton.id = "deleteButton";
            deleteButton.width = "20px";
            deleteButton.height = "100px";
            deleteButton.top = "100px";
            deleteButton.left = "20px";
            container3.appendChild(deleteButton);
    
            deleteButton.onclick = function() {
                conferences_handler.num_confs = VisualizationHandler.delAndUpdate(svg, document, conferences_handler, selected_conf_index, 20, 10);
            };
        }
        
        
        
    
        // Button click event function for manually creating a conference
        function enterFields(svg, document, conferences_handler, color) {
    
            // Open pop-up window to input manual data
            let newWindow = window.open("about:blank", "Conference Details", "width=700,height=400");
    
            //////////////////////// NON-MANUAL CONFERENCE ENTRY METHODS ////////////////////////
            // Allow for searching for a conference with it's title and a search bar
            var confTS = newWindow.document.createElement('confTS');
            confTS.setAttribute('style', 'white-space: pre;');
            confTS.textContent = "Search conference by title:";
    
            // Allow for searching conference by URL
            var confURLS = newWindow.document.createElement('confURLS');
            confURLS.setAttribute('style', 'white-space: pre;');
            confURLS.textContent = "\r\nLoad Conference by WikiCFP URL:";
    
            ////////////////////////////////////// OR //////////////////////////////////////
            var Or = newWindow.document.createElement('Or');
            Or.setAttribute('style', 'white-space: pre;');
            Or.textContent = "\r\nOR.." + "\r\nManually Enter Conference Details";
    
            //Ask user for conference information
            //Ask user for where the conference is taking place
            var confPlc = newWindow.document.createElement('confPlc');
            confPlc.setAttribute('style', 'white-space: pre;');
            confPlc.textContent = "\r\nPlease enter the location of your conference (City,State,Country):";
    
            //ask user for conference name
            var conf = newWindow.document.createElement('conf');
            conf.setAttribute('style', 'white-space: pre;');
            conf.textContent = "\r\nPlease Enter your Conference Name/Title:";
            
            //ask user for conference field
            var field = newWindow.document.createElement('conf');
            field.setAttribute('style', 'white-space: pre;');
            field.textContent = "\r\nPlease enter your Conference Field:";
    
            //Ask User for submission deadline
            var sub = newWindow.document.createElement('conf');
            sub.setAttribute('style', 'white-space: pre;');
            sub.textContent = "\r\nPlease enter the submission deadline (mm/dd/yyyy):";
    
            //Ask the user for a notification deadline
            var notif = newWindow.document.createElement('notif');
            notif.setAttribute('style', 'white-space: pre;');
            notif.textContent = "\r\nPlease Enter the notification deadline (mm/dd/yyyy):";
    
            //Ask user for decision deadline
            var dec = newWindow.document.createElement('conf');
            dec.setAttribute('style', 'white-space: pre;');
            dec.textContent = "\r\nPlease Enter the final version deadline (mm/dd/yyyy):";
    
            /////////////////////////// inputs ////////////////////////////////
            //input text box for searching by conference name
            var inputConferenceTitle = newWindow.document.createElement("input");
            inputConferenceTitle.setAttribute('type', 'text');
            
            //input text box for searching by conference URL
            var inputConferenceURL = newWindow.document.createElement("input");
            inputConferenceURL.setAttribute('type0', 'text');
    
            //input text box for searching by conference name
            var inputConfPlc = newWindow.document.createElement("input");
            inputConfPlc.setAttribute('type1', 'text');
    
            //input text box for conference name
            var inputConference = newWindow.document.createElement("input");
            inputConference.setAttribute('type2', 'text');
            
            var inputField = newWindow.document.createElement("input");
            inputField.setAttribute('type', 'text');
    
            //input text box for submission deadline
            var inputSub = newWindow.document.createElement("input");
            inputSub.setAttribute('type3', 'text');
    
            //input text box for notification deadline
            var inputConferenceNotif = newWindow.document.createElement("input");
            inputConferenceNotif.setAttribute('type4', 'text');
    
            //input text box for decision deadline
            var inputDec = newWindow.document.createElement("input");
            inputDec.setAttribute('type5', 'text');
    
            /////////////////////////////// SUBMIT /////////////////////////////////
            //create a submit button that will call the function to save inputs
            var submit_button = newWindow.document.createElement("button");
            submit_button.innerHTML = "Done";
            submit_button.id = "submit_button";
            submit_button.width = "20px";
            submit_button.height = "100px";
            submit_button.top = "100px";
            submit_button.left = "20px";
    
            submit_button.onclick = function() {
                //create an array to append the data entered for a new conference
                var newConference = [];
    
                //save new conference title
                var inTitle = inputConferenceTitle.value;
                newConference.push(inTitle);
    
                //save new conference URL
                var inURL = inputConferenceURL.value;
                newConference.push(inURL);
    
                //save new conference name
                var inConf = inputConference.value;
                newConference.push(inConf);
                
                //save new conference field
                var inField = inputField.value;
                newConference.push(inField);
    
                //save the new conferences submission deadline
                var inSub = inputSub.value;
                newConference.push(inSub);
    
                //save the notification deadline
                var inNotif = inputConferenceNotif.value;
                newConference.push(inNotif);
    
                //save the new conferences decision deadline
                var inDec = inputDec.value;
                newConference.push(inDec);
    
                conferences_handler.addConference(svg, document, newConference[2], conferences_handler.num_confs + 1,
                                conferences_handler.x, conferences_handler.y,
                                newConference[3], color, newConference[4], newConference[5], newConference[6], conferences_handler.curr_radius,
                                conferences_handler.inner_radius, conferences_handler.outer_radius,
                                conferences_handler.start_angle, conferences_handler.end_angle, 3, 10, conferences_handler.conferences,
                                conferences_handler.rings, conferences_handler.arcs);
    
                // display array for checking, close window, and return array containing new conference details
                console.log(newConference);
                console.log("Done");
                newWindow.close();
                return newConference;
            };
    
            //Add all elements to the pop-up window
            newWindow.document.body.appendChild(confTS);
            newWindow.document.body.appendChild(inputConferenceTitle);
            newWindow.document.body.appendChild(confURLS);
            newWindow.document.body.appendChild(inputConferenceURL);
            newWindow.document.body.appendChild(Or);
            newWindow.document.body.appendChild(confPlc);
            newWindow.document.body.appendChild(inputConfPlc);
            newWindow.document.body.appendChild(conf);
            newWindow.document.body.appendChild(inputConference);
            newWindow.document.body.appendChild(field);
            newWindow.document.body.appendChild(inputField);
            newWindow.document.body.appendChild(sub);
            newWindow.document.body.appendChild(inputSub);
            newWindow.document.body.appendChild(notif);
            newWindow.document.body.appendChild(inputConferenceNotif);
            newWindow.document.body.appendChild(dec);
            newWindow.document.body.appendChild(inputDec);
            newWindow.document.body.appendChild(submit_button);
        }
    
    
        /*
         * main function call
         */
        function init() {
            //svg creation
            var svg_width = document.body.clientWidth / 2;
            var svg_height = document.body.clientHeight;
            var svg = d3.select("#chart1").append("svg").attr("width", svg_width)
                                                     .attr("height", svg_height);
                                                     
            // dataHandler object for any functions having to do with data handling (self explanatory)
            data_handler = new dataHandler();
            
            // initialize conferences array that will hold all data about conferences
            var conferences = [];
            
            // handle grabbing file and populating conferences array with necessary data
            var finished_processing_data = false;
            
            const file_conference_data = document.getElementById('file_conference_data');
            file_conference_data.addEventListener('change', (event) => {
                const file_list = event.target.files;
                
                var reader = new FileReader();
                reader.onload = function(event) {
                    conference_file_text = event.target.result;
                    conferences = data_handler.grabConferenceData(conference_file_text);
                    
                    finished_processing_data = true;
                    
                    ////////////////////////////// INITIALIZATION OF VISUALIZATION HAS MOVED HERE //////////////////////////////////////////
                    //create conferences & their visuals and add all info to conferences_handler object
                    var conferences_handler = new VisualizationHandler(svg, document, svg_width/2, svg_height/2, conferences, num_confs);
            
                    //create months ring
                    conferences_handler.createMonthsRing(svg, conferences_handler.x, conferences_handler.y);
            
                    //create date line
                    var now = new Date();
                    conferences_handler.createDateLine(svg, data_handler, now, conferences_handler.x, conferences_handler.y, conferences_handler.curr_radius);
                
                    //handle onclick event for enterFields button (if 10 or more conferences made do not allow creation of another)
                    if (conferences_handler.num_confs >= 10) {
                        console.log("Maximum number of conferences allowed has been reached. " +
                                    "Please delete a conference before adding a new one.");
                    } else {
                        var button_enter_fields = document.getElementById("buttonEnterFields");
                        button_enter_fields.onclick = function () {
                            var color = "#48c9b0";
                            var conference_info = enterFields(svg, document, conferences_handler, color);
                        };
                    }
                
                
                
                
                };
                reader.readAsText(file_list[0]);
            });
    
    
            // conference temp. variables
            // having to do with creating visual aspect of conference
            var num_confs = 3;
            
            ////////////////////// NO LONGER NECESSARY, conferences POPULATED ABOVE //////////////
            //// more conference information
            //var conferences = [["IEEE CAMAD 2020", "Robotics", "#f08950", 24, 32, 48, 5, 9],
            //                   ["RAI--Ei and Scopus 2020", "AI", "#9ce490", 46, 80, 102, 6, 10],
            //                   ["IWSMR 2020", "Physics", "#90c6e4", 52, 96, 256, 5, 11]];
            //
            //
            ////var conf_names = ["IEEE CAMAD 2020", "RAI--Ei and Scopus 2020", "IWSMR 2020"];
            ////var conf_locations = ["Denver,CO,US", "Boston,MA,US", "Pittsburgh,PA,US"];
            ////var conf_fields = ["Robotics", "AI", "Physics"];
            ////var conf_colors = ["#f08950", "#9ce490", "#90c6e4"];
            ////var conferenceStart_dates = [5, 6, 5];
            ////var conferenceEnd_dates = [9, 10, 11];
            ////var notification_deadlines = [1, 4, 17];
            ////var submission_deadlines = [24, 46, 52];
            ////var decision_deadlines = [48, 102, 256];
    
            //TESTING, can be deleted if necessary
            //console.log(conferences_handler.names);
    
            // UNDER CONSTRUCTION
            // STILL NEED TO REMOVE CONFERENCE FROM conferences, AND CHECK IF I NEED TO DO ANYTHING ELSE FOR DELETION
            //num_confs = Conference.delAndUpdateConfVis(svg, conferences[2], num_confs, spacing, conferences, document, arc_size);
        }
    
        //calls main function using
        $(document).ready(function() {
            init();
        });
    
    </script>


</body>
</html>
