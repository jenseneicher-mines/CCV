<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Circular Conference Visualization</title>
    <meta name="description" content="Circular Conference Visualization">
    <!-- <link rel="stylesheet" href="main.css">
    <script src="math.js" type="text/javascript"></script>
-->
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>


    <style>
        .container {
            float: left;
        }
        body {
            height: 100%;
            margin: 0px;
            padding: 0px;
        }
        html {
            height: 100%;
        }
        div.fixed-rectangle {
            width: 100%;
            height: 9%;
            background-color: #AD193D;
            box-shadow: inset 2px 0px 15px #34010e;
        }
    </style>

</head>
<body style="background-color:#e8e8e8;">

<div class="container" id="chart1">
</div>

<div class="fixed-rectangle"></div>

<p style="position: absolute; font-size:30px; font-style: italic; color: whitesmoke; text-shadow: 1.2px 1.2px 1.2px #34010e; top: 0%; left: 1%;">Conference Cycle Visualization</p>

    <script> /////////////////////////////////////// VisualizationHandler script /////////////////////////////////////////////////////
        /*
        * VisualizationHandler
        *
        * Class handles all necessary functions needed to be performed on the macro visualization
        */
        class VisualizationHandler {
           /*
            * constructor
            *
            * @params svg, document, x, y, conferences, num_confs, names, fields, colors, submission_deadlines, abstract_deadlines, decision_deadlines
            * svg: svg
            * document: used in creation of Conference object
            * x: where visualization is centered on the x axis
            * y: where visualization is centered on the y axis
            * conferences: array of Conference objects inputted into visualization on start (currently is an empty array, as we have nothing stored)
            * num_confs: number of conferences
            * names: conference names
            * fields: conference fields
            * colors: conference visualization colors
            * submission_deadlines: conference submission deadlines
            * abstract_deadlines: conference abstract deadlines
            * decision_deadlines: conference decision deadlines
            *
            * This method handles the start-up creation of our visualization. As of now it takes lists of all conference info in order using
            * separate arrays. For example, for the creation of two conferences you would have names_array = ["name_1", "name_2"],
            * fields_array = ["field_1", "field_2"], etc. If it is seen that the better way of creating conferences is using a two dimensional
            * array of conference information (i.e. [["name_1", "field_1"]["field_1", "field_2"]]), then necessary adjustments will be made.
            * If this change is made it should be noted that updating info arrays IS ESSENTIAL
            */
           constructor(svg, document, x, y, conferences_data) {
               this.svg = svg;
               this.document = document;
               this.x = x;
               this.y = y;
        
               this.conferences = [];
               
               this.num_confs = 0;
               this.names = [];
               this.urls = [];
               this.fields = [];
               this.colors = [];
               this.submission_deadlines = [];
               this.decision_deadlines = [];
               this.conferenceStart_dates = [];
               this.conferenceEnd_dates = [];
               this.abstract_deadlines = [];
               this.locations = [];
               this.notes = [];
               this.inner_radii = [];
               this.outer_radii = [];
               this.start_angles = [];
               this.end_angles = [];
               this.conf_dates_start_angles = [];
               this.conf_dates_end_angles = [];
               this.rings = [];
               this.arcs = [];
               this.abstract_arcs = [];
               this.conf_dates_arcs = [];
               this.self = this;
        
               // smallest conference visualization radius
               this.curr_radius = 150;

               var now = new Date();
               this.initVisualization(this, svg, now, x, y, this.curr_radius);

               // populate conferences array & fill other empty arrays
               this.addMultipleConferences(svg, document, this, conferences_data, x, y);
           }

           initVisualization(conferences_handler, svg, now, x, y, r) {
                conferences_handler.createDateLine(svg, now, x, y, r);
                conferences_handler.createMonthsRing(svg, x, y);
           }

           addMultipleConferences(svg, document, conferences_handler, conferences_data, x, y) {
                // populate conferences array & fill other empty arrays
                for (var i = 0; i < conferences_data.length; i++) {
                    // handle single conference creation
                    conferences_handler.addConference(svg, document, conferences_handler, conferences_data[i], x, y);
                }
           }

           // handles addition of all conference information
           addConference(svg, document, conferences_handler, conference, x, y) {

                // variables necessary for visuals creation
                var spacing = 20;
                var ring_size = 3;
                var arc_size = 10;

                ///////////////// create variables for conference information and add to visualization conf arrays //////////////
                var conf_name = conference[0];                                                                                 //
                var conf_url = conference[1];                                                                                  //
                var conf_field = conference[2];                                                                                //
                var conf_color = conference[3];                                                                                //
                var conf_submission_deadline = conference[4];                                                                  //
                var conf_abstract_deadline = conference[5];                                                                    //
                var conf_decision_deadline = conference[6];                                                                    //
                var conf_start_date = conference[7];                                                                           //
                var conf_end_date = conference[8];                                                                             //
                var conf_location = conference[9];                                                                             //
                var conf_notes = conference[10];                                                                               //
                                                                                                                               //
                conferences_handler.names.push(conf_name);                                                                     //
                conferences_handler.urls.push(conf_url);                                                                       //
                conferences_handler.fields.push(conf_field);                                                                   //
                conferences_handler.colors.push(conf_color);                                                                   //
                conferences_handler.submission_deadlines.push(conf_submission_deadline);                                       //
                conferences_handler.abstract_deadlines.push(conf_abstract_deadline);                                           //
                conferences_handler.decision_deadlines.push(conf_decision_deadline);                                           //
                conferences_handler.conferenceStart_dates.push(conf_start_date);                                               //
                conferences_handler.conferenceEnd_dates.push(conf_end_date);                                                   //
                conferences_handler.locations.push(conf_location);                                                             //
                conferences_handler.notes.push(conf_notes);                                                                    //
                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                ////////// create variables for conference visualization creation and add to visualization conf arrays //////////
                var inner_radius = conferences_handler.curr_radius - arc_size/2;                                               //
                var outer_radius = conferences_handler.curr_radius + arc_size/2;                                               //
                var deadline_start_angle = ((conf_submission_deadline)/365) * (2*Math.PI);                                     //
                var deadline_end_angle = ((conf_decision_deadline)/365) * (2*Math.PI);                                         //
                var conf_dates_start_angle = ((conf_start_date)/365) * (2*Math.PI);                                            //
                var conf_dates_end_angle = ((conf_end_date)/365) * (2*Math.PI);                                                //
                                                                                                                               //
                conferences_handler.inner_radii.push(inner_radius);                                                            //
                conferences_handler.outer_radii.push(outer_radius);                                                            //
                conferences_handler.start_angles.push(deadline_start_angle);                                                   //
                conferences_handler.end_angles.push(deadline_end_angle);                                                       //
                conferences_handler.conf_dates_start_angles.push(conf_dates_start_angle);                                      //
                conferences_handler.conf_dates_end_angles.push(conf_dates_end_angle);                                          //
                /////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                console.log("addConference:", "Added conference");
                console.log("addConference:", "start & end angles", deadline_start_angle, deadline_end_angle);

                // create conference
                var conf = new Conference(conferences_handler, conf_name, conf_url, conferences_handler.conferences.length,
                                         x, y, conf_field, conf_color,
                                         conf_submission_deadline, conf_decision_deadline,
                                         conf_start_date, conf_end_date, conf_abstract_deadline, conf_location, conf_notes,
                                         conferences_handler.curr_radius, inner_radius, outer_radius, deadline_start_angle,
                                         deadline_end_angle, conf_dates_start_angle,
                                         conf_dates_end_angle, null, null, null, null);
               
                console.log("addConference:", conf.start_angle, conf.end_angle);
                console.log("addConference:", "conf x & y:", conf.x, conf.y);
                console.log("addConference:", "conference object:", conf);
                console.log("addConference:", conf.conf_dates_start_angle, conf.conf_dates_end_angle);

               ///////////////////// create conf visualization objects and add to visualization conf arrays /////////////////////
               //Create conferences visuals                                                                                    //
               Conference.createConfVisuals(svg, document, conferences_handler, conf,                                          //
                                            conf.start_angle, conf.end_angle, conf.conf_color,                                 //
                                            conf.conf_dates_start_angle, conf.conf_dates_end_angle);                           //
                                                                                                                               //
               conferences_handler.rings.push(conf.ring);                                                                      //
               conferences_handler.arcs.push(conf.arc);                                                                        //
               conferences_handler.abstract_arcs.push(conf.abstract_arc);                                                      //
               conferences_handler.conf_dates_arcs.push(conf.conf_dates_arc);                                                  //
               //////////////////////////////////////////////////////////////////////////////////////////////////////////////////
               
               // finally, push the conference object itself to the visualization handler
               conferences_handler.conferences.push(conf);

               // update num_confs count
               conferences_handler.num_confs += 1;
               // update curr_radius
               conferences_handler.curr_radius += 20;

               var now = new Date();
               conferences_handler.createDateLine(svg, now, x, y, conferences_handler.curr_radius);

               return conf;
           }
        
           static delAndUpdate(svg, document, conferences_handler, selected_index, spacing, arc_size) {
                var data_handler = new DataHandler();
               // remove ring and arc from d3 and svg
               console.log(conferences_handler, selected_index);
               
               conferences_handler.rings[selected_index].remove();       
               conferences_handler.arcs[selected_index].remove();
               conferences_handler.abstract_arcs[selected_index].remove();
               conferences_handler.conf_dates_arcs[selected_index].remove();
               
               console.log(conferences_handler.arcs, conferences_handler.rings);
               
               // check if you need to update the visualization
               if (conferences_handler.conferences[selected_index].conf_index < (conferences_handler.num_confs - 1)) {
                   console.log("Needs updating");
        
                   for (var i = selected_index+1; i < conferences_handler.num_confs; i++) {
                       console.log("Currently updating", i);
                       
                       var conference = conferences_handler.conferences[i];
                       console.log(conference);
                       conference.radius -= 20;
                       //conference.start_angle = 
                       
                       
                       
                       console.log("asdasdsdasdasd",conference);
        
                       //update ring
                       conference.conf_index -= 1;
                       console.log(conferences_handler.rings[i]);
                       conferences_handler.rings[i].attr("r", conference.radius);
        
                       //update arc
                       // 1) remove current arc
                       conferences_handler.arcs[i].remove();
                       conferences_handler.arcs[i] = null;
                       // 2) create new, updated arc and re-add to conf object
                       conferences_handler.arcs[i] = Conference.createConfArc(svg, document, conferences_handler, conference, conference.x, conference.y, conference.radius,
                                                                 conference.start_angle, conference.end_angle, conference.conf_color, arc_size);
                       
                       
                       //update abstract arc
                        // 1) remove current arc
                       conferences_handler.abstract_arcs[i].remove();
                       conferences_handler.abstract_arcs[i] = null;
                       
                       // 2) create new, updated arc and re-add to conf object
                       conferences_handler.abstract_arcs[i] = Conference.createConfAbstractsDeadlineArc(svg, document, conferences_handler,
                                                                                data_handler, conference, conference.x, conference.y, conference.radius);
                       
                       
                       //update conference dates arc
                        // 1) remove current arc
                       conferences_handler.conf_dates_arcs[i].remove();
                       conferences_handler.conf_dates_arcs[i] = null;
                       
                       // 2) create new, updated arc and re-add to conf object
                       conferences_handler.conf_dates_arcs[i] = Conference.createConfDatesArc(svg, document, conferences_handler, data_handler,
                                                                                conference, conference.x, conference.y, conference.radius,
                                                                                conference.conf_dates_start_angle, conference.conf_dates_end_angle);
                   }
               }
              conferences_handler.conferences = conferences_handler.conferences.slice(0, selected_index).concat(conferences_handler.conferences.slice(selected_index + 1, conferences_handler.conferences.length));
              
              conferences_handler.names = conferences_handler.names.slice(0, selected_index).concat(conferences_handler.names.slice(selected_index + 1, conferences_handler.names.length));
              conferences_handler.fields = conferences_handler.fields.slice(0, selected_index).concat(conferences_handler.fields.slice(selected_index + 1, conferences_handler.fields.length));
              conferences_handler.colors = conferences_handler.colors.slice(0, selected_index).concat(conferences_handler.colors.slice(selected_index + 1, conferences_handler.colors.length));
              conferences_handler.submission_deadlines = conferences_handler.submission_deadlines.slice(0, selected_index).concat(conferences_handler.submission_deadlines.slice(selected_index + 1, conferences_handler.submission_deadlines.length));
              conferences_handler.decision_deadlines = conferences_handler.decision_deadlines.slice(0, selected_index).concat(conferences_handler.decision_deadlines.slice(selected_index + 1, conferences_handler.decision_deadlines.length));
              conferences_handler.conferenceStart_dates = conferences_handler.conferenceStart_dates.slice(0, selected_index).concat(conferences_handler.conferenceStart_dates.slice(selected_index + 1, conferences_handler.conferenceStart_dates.length));
              conferences_handler.conferenceEnd_dates = conferences_handler.conferenceEnd_dates.slice(0, selected_index).concat(conferences_handler.conferenceEnd_dates.slice(selected_index + 1, conferences_handler.conferenceEnd_dates.length));
              conferences_handler.abstract_deadlines = conferences_handler.abstract_deadlines.slice(0, selected_index).concat(conferences_handler.abstract_deadlines.slice(selected_index + 1, conferences_handler.abstract_deadlines.length));
              conferences_handler.locations = conferences_handler.locations.slice(0, selected_index).concat(conferences_handler.locations.slice(selected_index + 1, conferences_handler.locations.length));
              conferences_handler.inner_radii = conferences_handler.inner_radii.slice(0, selected_index).concat(conferences_handler.inner_radii.slice(selected_index + 1, conferences_handler.inner_radii.length));
              conferences_handler.outer_radii = conferences_handler.outer_radii.slice(0, selected_index).concat(conferences_handler.outer_radii.slice(selected_index + 1, conferences_handler.outer_radii.length));
              conferences_handler.start_angles = conferences_handler.start_angles.slice(0, selected_index).concat(conferences_handler.start_angles.slice(selected_index + 1, conferences_handler.start_angles.length));
              conferences_handler.end_angles = conferences_handler.end_angles.slice(0, selected_index).concat(conferences_handler.end_angles.slice(selected_index + 1, conferences_handler.end_angles.length));
              conferences_handler.rings = conferences_handler.rings.slice(0, selected_index).concat(conferences_handler.rings.slice(selected_index + 1, conferences_handler.rings.length));
              conferences_handler.arcs = conferences_handler.arcs.slice(0, selected_index).concat(conferences_handler.arcs.slice(selected_index + 1, conferences_handler.arcs.length));
        
              
              //conferences_handler.
        
               // return updated num_confs
               return conferences_handler.num_confs - 1;
           }
        
           // creates line on visualization indicating the day
           createDateLine(svg, now, x, y, r) {
               //Create data handler
               var data_handler = new DataHandler();
               //handle date conversion for finding correct angle
               var converted_date = data_handler.convertDateToNum(now);
               console.log(converted_date);
               var date_angle = (converted_date/365) * (2*Math.PI);
               console.log(date_angle);
               var newly_built_date_line = d3.svg.line.radial().angle(date_angle - (Math.PI/2)).radius(function(d) { return d; } );
               console.log(newly_built_date_line);
        
               //MAGIC NUMBER 15 LOOKIN REEEEAAAAAL SHIT
               var date_line = svg.append("line").attr("x1", x).attr("y1", y)
                                                 .attr("x2", x + (r - 15)*Math.cos(date_angle - (Math.PI/2))).attr("y2", y + (r - 15)*Math.sin(date_angle - (Math.PI/2)))
                                                 .attr("stroke-width", 2).attr("stroke", "black");
               return date_line;
           }
           
           // creates 12 month arcs inside the smallest conference radius to show the user how time is alloted in the visualization
           createMonthsRing(svg, x, y) {
               // how month names are displayed, change this array if you would like different names to be shown
               var months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        
               // empty arrays to store the 12 created month arcs
               var month_arcs = [];
               var month_text_objs = [];
        
               // math portion to properly define size and spacing of arcs
               var spacing = (0.005*((2*Math.PI)/12));
               var arc_length = (((2*Math.PI)/12) - (2*spacing));
               var start_angle = spacing;
               var end_angle = arc_length - spacing;
        
               // begin creation of the 12 month arcs and their accompanying text
               for (var i = 0; i < 12; i++) {
                    //init. and append new conference arc to svg
                   var newly_built_arc = d3.svg.arc().innerRadius(120)
                                                         .outerRadius(140)
                                                         .startAngle(start_angle)
                                                         .endAngle(end_angle);
                    
                   var defs = svg.append("defs"); 
                    
                   var dropShadowFilter = defs.append('svg:filter')
                       .attr('id', 'drop-shadow')
                       .attr('filterUnits', "userSpaceOnUse")
                       .attr('width', '250%')
                       .attr('height', '250%');
                     dropShadowFilter.append('svg:feGaussianBlur')
                       .attr('in', 'SourceGraphic')
                       .attr('stdDeviation', 2)
                       .attr('result', 'blur-out');
                     dropShadowFilter.append('svg:feOffset')
                       .attr('in', 'color-out')
                       .attr('dx', 3)
                       .attr('dy', 3)
                       .attr('result', 'the-shadow');
                     dropShadowFilter.append('svg:feBlend')
                       .attr('in', 'SourceGraphic')
                       .attr('in2', 'the-shadow')
                       .attr('mode', 'normal');                                      
                                                         
                   
                   var new_month_arc = svg.append("path").attr("id", months[i] + "_arc").attr("d", newly_built_arc).attr("transform", "translate("+x+", "+y+")").style("fill", "#AD193D");
        
        
        
                   //var months_text_arc = svg.append("path").attr("id", "path_text_months").attr("d", "M75,300 A125,125 0 0,1 325,300").attr("fill", "none").style("stroke", "#AAAAAA");
                   var months_text = svg.append("text").attr("id", months[i])
                                                       .attr("x", 15)   //Move the text from the start angle of the arc
                                                       .attr("dy", 18) //Move the text down
                                                       .style("font-size", 12)
                                                       .style("fill", "#ffffff")
                                                       .style("font-style", "italic")
                                                       .append("textPath").attr("xlink:href", "#"+months[i]+"_arc").style("text-anchor", "right").text(months[i]);
        
                   // store the created text and arc (not really necessary as of now, but it's here just in case)
                   month_arcs.push(new_month_arc);
                   month_text_objs.push(months_text);
        
                   // update start and end angles for the next arc to be created
                   start_angle += arc_length + 2*spacing;
                   end_angle += arc_length + 2*spacing;
               }
           }
        }   
    </script> 
    <script> ///////////////////////////////////////////// Conference script /////////////////////////////////////////////////////////
       /********************                                                                                                        //
        * Conference Class *                                                                                                        //
        ********************/                                                                                                       //
       class Conference {                                                                                                           //
           //////////////////////////////////////////////// constructor /////////////////////////////////////////////////////////// //
           constructor(conferences_handler, conf_name, conf_url, conf_index, x, y, conf_field, conf_color,                       // //
                       submission_deadline, decision_deadline, conferenceStart_date, conferenceEnd_date, abstract_deadline,      // //
                       conf_location, notes, radius, inner_radius, outer_radius, start_angle, end_angle,                         // //
                       conf_dates_start_angle, conf_dates_end_angle, ring, arc, abstract_arc, conf_dates_arc) {                  // //
                                                                                                                                 // //
               // var. having to do with conference info.                                                                        // //
               this.conferences_handler = conferences_handler;                                                                   // //
               this.conf_name = conf_name;                                                                                       // //
               this.conf_url = conf_url;                                                                                         // //
               this.conf_index = conf_index;                                                                                     // //
               this.conf_field = conf_field;                                                                                     // //
                                                                                                                                 // //
               this.conf_location = conf_location;                                                                               // //
               this.notes = notes;                                                                                               // //
                                                                                                                                 // //
               // var. having to do with conference vis.                                                                         // //
               this.x = x;                                                                                                       // //
               this.y = y;                                                                                                       // //
               this.radius = radius;                                                                                             // //
               this.inner_radius = inner_radius;                                                                                 // //
               this.outer_radius = outer_radius;                                                                                 // //
               this.conf_dates_start_angle = conf_dates_start_angle;                                                             // //
               this.conf_dates_end_angle = conf_dates_end_angle;                                                                 // //
               this.start_angle = start_angle;                                                                                   // //
               this.end_angle = end_angle;                                                                                       // //
               this.conf_color = conf_color;                                                                                     // //
                                                                                                                                 // //
               // var. having to do with both conf. vis. & conf. info.                                                           // //
               this.submission_deadline = submission_deadline;                                                                   // //
               this.decision_deadline = decision_deadline;                                                                       // //
               this.conferenceStart_date = conferenceStart_date;                                                                 // //
               this.conferenceEnd_date = conferenceEnd_date;                                                                     // //
               this.abstract_deadline = abstract_deadline;                                                                       // //
                                                                                                                                 // //
                                                                                                                                 // //
               // change ring and arc size here                                                                                  // //
               this.ring_size = 3;                                                                                               // //
               this.arc_size = 10;                                                                                               // //
                                                                                                                                 // //
               // conf. shapes                                                                                                   // //
               this.ring = ring;                                                                                                 // //
               this.arc = arc;                                                                                                   // //
               this.abstract_arc = abstract_arc;                                                                                 // //
               this.conf_dates_arc = conf_dates_arc;                                                                             // //
           }                                                                                                                     // //
           //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// //
                                                                                                                                    //
           //////////// creates conference ring visualization and appends it to svg obj, also adds onclick event to ring ////////// //
           /*********************************************************************************************                        // //
            * createConfRing                                                                            *                        // //
            * @params svg, document, conference, x, y, radius, color, ring_size                         *                        // //
            * svg: svg object, used to add created shapes into svg                                      *                        // //
            * document: html document obj, necessary to pass into showDetails function inside onclick   *                        // //
            * conferences_handler: VisualizationHandler obj, necessary to pass into showDetail function *                        // //
            * conference: conference obj, used for info inside of it                                    *                        // //
            * color: color of circle or arc                                                             *                        // //
            *********************************************************************************************/                       // //
           static createConfRing(svg, document, conferences_handler, conference, color) {                                        // //
               var defs = svg.append("defs");                                                                                    // //
                                                                                                                                 // //
               var dropShadowFilter = defs.append('svg:filter')                                                                  // //
                 .attr('id', 'drop-shadow')                                                                                      // //
                 .attr('filterUnits', "userSpaceOnUse")                                                                          // //
                 .attr('width', '250%')                                                                                          // //
                 .attr('height', '250%');                                                                                        // //
               dropShadowFilter.append('svg:feGaussianBlur')                                                                     // //
                 .attr('in', 'SourceGraphic')                                                                                    // //
                 .attr('stdDeviation', 2)                                                                                        // //
                 .attr('result', 'blur-out');                                                                                    // //
               dropShadowFilter.append('svg:feOffset')                                                                           // //
                 .attr('in', 'color-out')                                                                                        // //
                 .attr('dx', 3)                                                                                                  // //
                 .attr('dy', 3)                                                                                                  // //
                 .attr('result', 'the-shadow');                                                                                  // //
               dropShadowFilter.append('svg:feBlend')                                                                            // //
                 .attr('in', 'SourceGraphic')                                                                                    // //
                 .attr('in2', 'the-shadow')                                                                                      // //
                 .attr('mode', 'normal');                                                                                        // //
                                                                                                                                 // //
                                                                                                                                 // //
                                                                                                                                 // //
               //init. and append new conference ring to svg                                                                     // //
               console.log("createConfRing: ", svg, document);                                                                   // //
               var new_conf_ring = svg.append("circle").attr("cx", conferences_handler.x).attr("cy", conferences_handler.y)      // //
                                                       .attr("r", conferences_handler.curr_radius)                               // //
                                                       .attr("stroke", color)                                                    // //
                                                       .attr("stroke-width", conference.ring_size)                               // //
                                                       .style("fill", "none")                                                    // //
                                                       .style("filter", "url(#drop-shadow)")                                     // //
                                                       .on("click", function() {                                                 // //
                                                           showDetails(svg, document, conferences_handler, conference);          // //
                                                           selected_conf_index = conference.conf_index;                          // //
                                                       });                                                                       // //
                                                                                                                                 // //
                                                                                                                                 // //
                                                                                                                                 // //
                                                                                                                                 // //
               console.log("createConfRing: ", new_conf_ring);                                                                   // //
               return new_conf_ring;                                                                                             // //
           }                                                                                                                     // //
           //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// //
                                                                                                                                    //
           ///////////////////////////////// creates large conference arc for first and final deadlines /////////////////////////// //
           /*********************************************************************************************                        // //
            * createConfArc                                                                             *                        // //
            * @params: svg, document, conference, x, y, radius, start_angle, end_angle, color, arc_size *                        // //
            * svg: svg object, used to add created shapes into svg                                      *                        // //
            * document: html document obj, necessary to pass into showDetails function inside onclick   *                        // //
            * conferences_handler: VisualizationHandler obj                                             *                        // //
            * conference: conference obj, used for info inside of it                                    *                        // //
            * start_angle, end_angle: used to define start and end points if arc is being created       *                        // //
            * color: color of circle or arc                                                             *                        // //
            *********************************************************************************************/                       // //
           static createConfArc(svg, document, conferences_handler, conference, start_angle, end_angle, color) {                 // //
               //init. and append new conference arc to svg                                                                      // //
               var newly_built_arc = d3.svg.arc().innerRadius(conferences_handler.curr_radius - (conference.arc_size/2))         // //
                                                     .outerRadius(conferences_handler.curr_radius + (conference.arc_size/2))     // //
                                                     .startAngle(start_angle)                                                    // //
                                                     .endAngle(end_angle);                                                       // //
                                                                                                                                 // //
               var new_conf_arc = svg.append("path")                                                                             // //
                                    .attr("d", newly_built_arc)                                                                  // //
                                    .attr("transform", "translate("+conferences_handler.x+", "+conferences_handler.y+")")        // //
                                    .style("fill", color)                                                                        // //
                                    .on("click", function() {                                                                    // //
                                        showDetails(svg, document, conferences_handler, conference);                             // //
                                        selected_conf_index = conference.conf_index;                                             // //
                                    });                                                                                          // //
               return new_conf_arc;                                                                                              // //
           }                                                                                                                     // //
           //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// //
                                                                                                                                    //
           /////////////////////////////////// creates arc for actual conference dates in white /////////////////////////////////// //
           /*********************************************************************************************                        // //
            * createConfDatesArc                                                                        *                        // //
            * @params: svg, document, conference, x, y, radius, start_angle, end_angle, color, arc_size *                        // //
            * svg: svg object, used to add created shapes into svg                                      *                        // //
            * document: html document obj, necessary to pass into showDetails function inside onclick   *                        // //
            * conferences_handler: VisualizationHandler obj                                             *                        // //
            * conference: conference obj, used for info inside of it                                    *                        // //
            * start_angle, end_angle: used to define start and end points if arc is being created       *                        // //
            *********************************************************************************************/                       // //
           static createConfDatesArc(svg, document, conferences_handler, conference, start_angle, end_angle) {                   // //
               //init. and append new conference arc to svg                                                                      // //
               var newly_built_arc = d3.svg.arc().innerRadius(conferences_handler.curr_radius - (conference.arc_size/2))         // //
                                                     .outerRadius(conferences_handler.curr_radius + (conference.arc_size/2))     // //
                                                     .startAngle(start_angle)                                                    // //
                                                     .endAngle(end_angle);                                                       // //
                                                                                                                                 // //
               var new_conf_arc = svg.append("path")                                                                             // //
                                    .attr("d", newly_built_arc)                                                                  // //
                                    .attr("transform", "translate("+conferences_handler.x+", "+conferences_handler.y+")")        // //
                                    .style("fill", "#ffffff")                                                                    // //
                                    .on("click", function() {                                                                    // //
                                        showDetails(svg, document, conferences_handler, conference);                             // //
                                        selected_conf_index = conference.conf_index;                                             // //
                                    });                                                                                          // //
               return new_conf_arc;                                                                                              // //
           }                                                                                                                     // //
           //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// //
                                                                                                                                    //
           ////////////////////////////////////// creates arc for abstract deadline in white ////////////////////////////////////// //
           /*********************************************************************************************                        // //
            * createConfAbstractDeadlineArc                                                             *                        // //
            * @params: svg, document, conference, x, y, radius, start_angle, end_angle, color, arc_size *                        // //
            * svg: svg object, used to add created shapes into svg                                      *                        // //
            * document: html document obj, necessary to pass into showDetails function inside onclick   *                        // //
            * conferences_handler: VisualizationHandler obj                                             *                        // //
            * conference: conference obj, used for info inside of it                                    *                        // //
            *********************************************************************************************/                       // //
           static createConfAbstractDeadlineArc(svg, document, conferences_handler, conference) {                                // //
               //init. and append new conference arc to svg                                                                      // //
               var arc_spacing = (Math.PI/360)*2;                                                                                // //
                                                                                                                                 // //
               var abstract_deadline_angle = (((conference.abstract_deadline)/365) * (2*Math.PI));// - arc_spacing*30;           // //
                                                                                                                                 // //
               var newly_built_arc = d3.svg.arc().innerRadius(conferences_handler.curr_radius - (conference.arc_size/2))         // //
                                                 .outerRadius(conferences_handler.curr_radius + (conference.arc_size/2))         // //
                                                 .startAngle(abstract_deadline_angle - arc_spacing)                              // //
                                                 .endAngle(abstract_deadline_angle + arc_spacing);                               // //
                                                                                                                                 // //
               var new_conf_arc = svg.append("path")                                                                             // //
                                    .attr("d", newly_built_arc)                                                                  // //
                                    .attr("transform", "translate("+conferences_handler.x+", "+conferences_handler.y+")")        // //
                                    .style("fill", "#ffffff")                                                                    // //
                                    .on("click", function() {                                                                    // //
                                        showDetails(svg, document, conferences_handler, conference);                             // //
                                        selected_conf_index = conference.conf_index;                                             // //
                                    });                                                                                          // //
               return new_conf_arc;                                                                                              // //
                                                                                                                                 // //
                                                                                                                                 // //
           }                                                                                                                     // //
           //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// //
                                                                                                                                    //
           ////////////////////////////////////// creates arc for submission deadline in white //////////////////////////////////// //
           /*********************************************************************************************                        // //
            * createConfDatesArc                                                                        *                        // //
            * @params: svg, document, conference, x, y, radius, start_angle, end_angle, color, arc_size *                        // //
            * svg: svg object, used to add created shapes into svg                                      *                        // //
            * document: html document obj, necessary to pass into showDetails function inside onclick   *                        // //
            * conferences_handler: VisualizationHandler obj                                             *                        // //
            * conference: conference obj, used for info inside of it                                    *                        // //
            *********************************************************************************************/                       // //
            static createConfSubmissionDeadlineArc(svg, document, conferences_handler, conference) {                             // //
               //init. and append new conference arc to svg                                                                      // //
               var arc_spacing = (Math.PI/360)*2;                                                                                // //
                                                                                                                                 // //
               var abstract_deadline_angle = (((conference.submission_deadline)/365) * (2*Math.PI));// - arc_spacing*30;         // //
                                                                                                                                 // //
               var newly_built_arc = d3.svg.arc().innerRadius(conferences_handler.curr_radius - (conference.arc_size/2))         // //
                                                 .outerRadius(conferences_handler.curr_radius + (conference.arc_size/2))         // //
                                                 .startAngle(abstract_deadline_angle - arc_spacing)                              // //
                                                 .endAngle(abstract_deadline_angle + arc_spacing);                               // //
                                                                                                                                 // //
               var new_conf_arc = svg.append("path")                                                                             // //
                                    .attr("d", newly_built_arc)                                                                  // //
                                    .attr("transform", "translate("+conferences_handler.x+", "+conferences_handler.y+")")        // //
                                    .style("fill", "#ffffff")                                                                    // //
                                    .on("click", function() {                                                                    // //
                                        showDetails(svg, document, conferences_handler, conference);                             // //
                                        selected_conf_index = conference.conf_index;                                             // //
                                    });                                                                                          // //
               return new_conf_arc;                                                                                              // //
                                                                                                                                 // //
                                                                                                                                 // //
           }                                                                                                                     // //
           //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// //
                                                                                                                                    //
           /*                                                                                                                       //
            * createConfVisuals                                                                                                     //
            *                                                                                                                       //
            * Uses the two previous function to handle all Conference visualization creation                                        //
            */                                                                                                                      //
           static createConfVisuals(svg, document, conferences_handler, conf, start_angle, end_angle,                               //
                                    conf_color, conf_start_angle, conf_end_angle) {                                                 //
                console.log("createConfVisuals:", "end_angle:", end_angle);                                                         //
                if (isNaN(end_angle)) {                                                                                             //
                     conf.ring = Conference.createConfRing(svg, document, conferences_handler, conf, conf_color);                   //
                     conf.abstract_arc = Conference.createConfSubmissionDeadlineArc(svg, document, conferences_handler, conf);      //
                } else {                                                                                                            //
                    conf.ring = Conference.createConfRing(svg, document, conferences_handler, conf, conf_color);                    //
                    conf.arc = Conference.createConfArc(svg, document, conferences_handler, conf,                                   //
                                                        start_angle, end_angle, conf_color);                                        //
                    console.log("createConfVisuals:", conf_start_angle, conf_end_angle);                                            //
                    conf.conf_dates_arc = Conference.createConfDatesArc(svg, document, conferences_handler,                         //
                                                                        conf, conf_start_angle, conf_end_angle);                    //
                                                                                                                                    //
                    console.log("createConfVisuals:", "conf", conf);                                                                //
                                                                                                                                    //
                    if ((conf.abstract_deadline != "") && (conf.abstract_deadline != null)) {                                       //
                        conf.abstract_arc = Conference.createConfAbstractDeadlineArc(svg, document, conferences_handler, conf);     //
                    }                                                                                                               //
                }                                                                                                                   //
           }                                                                                                                        //
       }                                                                                                                            //
       ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    </script>
    <script> //////////////////////////////////////////// DataHandler script /////////////////////////////////////////////////////////
       /**************************************************                                                                          //
        * DataHandler                                    *                                                                          //
        *                                                *                                                                          //
        * Class used for any necessary data manipulation *                                                                          //
        **************************************************/                                                                         //
        class DataHandler {                                                                                                         //
           //////////////// constructor (no args necessary in creation of dataHandler obj as of yet) ////////////////               //
           constructor() {}                                                                                        //               //
           //////////////////////////////////////////////////////////////////////////////////////////////////////////               //
                                                                                                                                    //
           //////////////////////////// used to create conference data array from file format ///////////////////////               //
           /*********************************************************************************************          //               //
            * grabConferenceData                                                                        *          //               //
            * @params input_file                                                                        *          //               //
            * input_file: data in file format, used in creation of conference data array                *          //               //
            *********************************************************************************************/         //               //                                                                             //               //
           grabConferenceData(input_file) {                                                                        //               //
               var file_lines = input_file.split('\n');                                                            //               //
                                                                                                                   //               //
               var conference_data = [];                                                                           //               //
                                                                                                                   //               //
               var num_confs = parseInt(file_lines[0], 10);                                                        //               //
               console.log("grabConferenceData:", num_confs);                                                      //               //
                                                                                                                   //               //
               for (var j = 1; j < 1+num_confs; j++) {                                                             //               //
                   var split_line = file_lines[j].split(',');                                                      //               //
                   console.log(split_line.length);                                                                 //               //
                                                                                                                   //               //
                   var conference = [];                                                                            //               //
                   for (var k = 0; k < split_line.length; k++) {                                                   //               //
                       if ((k <= 3) || (k == 9) || (k == 10)) {                                                    //               //
                           conference.push(split_line[k]);                                                         //               //
                       } else {                                                                                    //               //
                           conference.push(parseInt(split_line[k], 10));                                           //               //
                       }                                                                                           //               //
                   }                                                                                               //               //
                   console.log("grabConferenceData:", conference);                                                 //               //
                   conference_data.push(conference);                                                               //               //
               }                                                                                                   //               //
               console.log("grabConferenceData:", "conference_data:", conference_data);                            //               //
               return conference_data;                                                                             //               //
           }                                                                                                       //               //
           //////////////////////////////////////////////////////////////////////////////////////////////////////////               //
                                                                                                                                    //
            ////////////////////////////////// used to create downloadable txt file //////////////////////////////////               //
           /*********************************************************************************************          //               //
            * exportConferenceData                                                                      *          //               //
            * @params conferences                                                                       *          //               //
            * conferences: data in conf data array format, used in creation of exported txt file        *          //               //
            *********************************************************************************************/         //               //
           exportConferenceData(conferences) {                                                                     //               //
               var text_conferences_data = "";                                                                     //               //
               text_conferences_data += conferences.length.toString() + '\n';                                      //               //
                                                                                                                   //               //
               for (var k = 0; k < conferences.length; k++) {                                                      //               //
                   var name = conferences[k].conf_name;                                                            //               //
                   var url = conferences[k].conf_url;                                                              //               //
                   var field = conferences[k].conf_field;                                                          //               //
                   var color = conferences[k].conf_color;                                                          //               //
                   var submission_deadline = conferences[k].submission_deadline;                                   //               //
                   var abstract_deadline = conferences[k].abstract_deadline;                                       //               //
                   var decision_deadline = conferences[k].decision_deadline;                                       //               //
                   var conference_start_date = conferences[k].conferenceStart_date;                                //               //
                   var conference_end_date = conferences[k].conferenceEnd_date;                                    //               //
                   var location = conferences[k].conf_location;                                                    //               //
                   var notes = conferences[k].notes;                                                               //               //
                   text_conferences_data += name + ',' + url + ','+ field + ',' + color + ',' +                    //               //
                                                submission_deadline + ',' + abstract_deadline + ',' +              //               //
                                                decision_deadline + ',' +                                          //               //
                                                conference_start_date + ',' + conference_end_date +                //               //
                                                ',' + location + ',' + notes + '\n';                               //               //
               }                                                                                                   //               //
               console.log("exportConferenceData:", "conference data to be exported:", text_conferences_data);     //               //
                                                                                                                   //               //
               // create blob and use to download txt file                                                         //               //
               var text_file = null;                                                                               //               //
               var blob_text_conferences_data = new Blob([text_conferences_data], {type:'text/plain'});            //               //
               text_file = window.URL.createObjectURL(blob_text_conferences_data);                                 //               //
               return text_file;                                                                                   //               //
           }                                                                                                       //               //
           //////////////////////////////////////////////////////////////////////////////////////////////////////////               //
                                                                                                                                    //
           /////////////// converts date object to a number between 1 and 366 (considers leap years) ////////////////               //
           /*********************************************************************************************          //               //
            * convertDateToNum                                                                          *          //               //
            * @params now                                                                               *          //               //
            * now: Date obj holding date to be converted                                                *          //               //
            *********************************************************************************************/         //               //
           convertDateToNum(now) {                                                                                 //               //
               var start = new Date(now.getFullYear(), 0, 0);                                                      //               //
               var diff = (now - start) + ((start.getTimezoneOffset() - now.getTimezoneOffset()) * 60 * 1000);     //               //
               var oneDay = 1000 * 60 * 60 * 24;                                                                   //               //
               var day = Math.round(diff / oneDay);                                                                //               //
               console.log('Day of year: ' + day);                                                                 //               //
               return day;                                                                                         //               //
           }                                                                                                       //               //
           //////////////////////////////////////////////////////////////////////////////////////////////////////////               //
                                                                                                                                    //
           ////////////// converts number from 1 to 366 (considering leap years) into a date object /////////////////               //
           /*********************************************************************************************          //               //
            * grabConferenceData                                                                        *          //               //
            * @params input_file                                                                        *          //               //
            * now: Date obj holding TODAY'S DATE, used only to grab the year for leap year check        *          //               //
            * now_num: the date of year as number to be converted to Date obj                           *          //               //
            *********************************************************************************************/         //               //
           convertNumToDate(now, now_num) {                                                                        //               //
               var date = new Date(now.getFullYear(), 0); // initialize a date in `year-01-01`                     //               //
               return new Date(date.setDate(now_num)); // add the number of days                                   //               //
           }                                                                                                       //               //
           //////////////////////////////////////////////////////////////////////////////////////////////////////////               //
        }                                                                                                                           //
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    </script>

<script>
    // declare variable used to keep track of what conference is being looked at currently
    var selected_conf_index;

    // initialize conferences array that will hold all data about conferences
    var conferences = [];

    var port = 8000;

    function returnConfString() {
        var confString;

        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange=function() {
            console.log("server:", xmlhttp.readyState, xmlhttp.status);
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                confString = xmlhttp.responseText;
                console.log("server:", confString);
                return confString;
            }
            console.log("Error in server request status or state");
        };
        xmlhttp.open("GET", "http://localhost:"+port+"/files", false);
        xmlhttp.send();
        return confString;
    }

    function showDetails(svg, document, conferences_handler, conference) {
        // create DataHandler
        var data_handler = new DataHandler();
        
        // create Date obj
        var now = new Date();

        // new elements are added dynamically on conference visualization click. This means that objects
        // need to be deleted and re-added each time a new conference is clicked. This array and for loop
        //
        // handles conference descriptive element deletions
        var details_element_ids = ["conferenceName", "mainParagraph"];
        for (var i = 0; i < details_element_ids.length; i++) {
            if (document.getElementById(details_element_ids[i])){
                var elem = document.getElementById(details_element_ids[i]);
                elem.remove();
            }
        }

        //create a new container that will appear on the left side of the screen
        var container2 = document.createElement("div");
        container2.setAttribute("style","float: left; width = 710px; z-index: 1;");
        document.body.appendChild(container2);

        // Header element, will contain Conference Name
        var h1 = document.createElement('h1');
        h1.id = "conferenceName";
        h1.textContent = conference.conf_name;
        h1.style.color = conference.conf_color;
        h1.style.borderBottom = "solid #AD193D";
        h1.style.textShadow = "1px 1px 1px #000000";
        var left = document.clientWidth/2;
        var top = document.clientHeight/2;
        h1.style.width = "710px";
        container2.appendChild(h1);

        // Paragraph element, unknown what this will contain
        var p1 = document.createElement('p1');
        p1.id = "mainParagraph";
        p1.setAttribute("style", "white-space: pre; position: absolute; font-size:20px; z-index: 1; left: "+left+"; top: "+top+"; width:710px; height:275px;");
        p1.textContent = "Conference Topic: " + conference.conf_field + "\r\nLocation: " + conference.conf_location + "\r\nSubmission Deadline: " +
            data_handler.convertNumToDate(new Date(), conference.submission_deadline).toDateString() + "\r\nAbstract Deadline: " +
            data_handler.convertNumToDate(new Date(), conference.abstract_deadline).toDateString() + "\r\nFinal Version Due: " +
            data_handler.convertNumToDate(new Date(), conference.decision_deadline).toDateString() + "\r\n" + "\r\nNotes: " + conference.notes;
        p1.setAttribute('class', 'note');
        p1.setAttribute('vertical-align', 'baseline');
        p1.style.border = "thick solid #F3EBCE";
        p1.style.backgroundColor = "linen";
        p1.style.borderBottomWidth = "6px";
        p1.style.borderRightWidth = "5px";
        p1.style.borderRightColor = "#e3d8c6";
        p1.style.borderBottomColor = "#e3d8c6";
        container2.appendChild(p1);
    }

    /*
     * main function call
     */
        function init() {
            //////////// svg creation (used to show all aspects of conference visualization, /////////////////////////////////////
            ////////// any visualization objects are appended to this svg object dynamically) ////////////////////////////////////
            var svg_width = document.body.clientWidth / 2;                                                                      //
            var svg_height = document.body.clientHeight;                                                                        //
            var svg = null;                                                                                                     //
                                                                                                                                //
            // svg object creation                                                                                              //
            svg = d3.select("#chart1").append("svg").attr("width", svg_width).attr("height", svg_height);                       //
                                                                                                                                //
            // svg object check                                                                                                 //
            if (svg != null) {                                                                                                  //
                console.log("init:", "Successfully created svg obj:", svg);                                                     //
            } else {                                                                                                            //
                console.log("init:", "Could not create svg obj");                                                               //
            }                                                                                                                   //
            //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                               
            //// dataHandler object for any functions having to do with data handling (self explanatory) /////////////////////////
            var data_handler = null;                                                                                            //
                                                                                                                                //
            // DataHandler object creation                                                                                      //
            data_handler = new DataHandler();                                                                                   //
                                                                                                                                //
            // DataHandler object check                                                                                         //
            if (data_handler != null) {                                                                                         //
                console.log("init:", "Successfully created DataHandler class obj", data_handler);                               //
            } else {                                                                                                            //
                console.log("init:", "Could not create DataHandler class obj");                                                 //
            }                                                                                                                   //
            //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                         
            ///////////////////// initialize conferences array that will hold all data about conferences /////////////////////////
            var returnString = returnConfString();                                                                              //
            console.log("init:", "conference data in file format returned from server:", returnString);                         //
            var conferences = [];                                                                                               //
            conferences = data_handler.grabConferenceData(returnString);                                                        //
            console.log("init:", "converted conference data:", conferences);                                                    //
            //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////                                             
                                                                                                                               
            ////////////////////// create conferences array and conferences_handler //////////////////////////////////////////////
                                                                                                                                //
            // create conferences_handler                                                                                       //
            var conferences_handler = null;                                                                                     //
            conferences_handler = new VisualizationHandler(svg, document, svg_width/2, svg_height/2, conferences);              //
                                                                                                                                //
            // VisualizationHandler obj check                                                                                   //
            if (conferences_handler != null) {                                                                                  //
                console.log("init:", "Successfully created VisualizationHandler class obj",                                     //
                                                            conferences_handler);                                               //
            } else {                                                                                                            //
                console.log("init:", "Could not create Visualizationhandler class obj");                                        //
            }                                                                                                                   //
            //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        }

        //calls main function (init)
        $(document).ready(function() {
            console.log("Start");
            init();
        });

    </script>


</body>
</html>
