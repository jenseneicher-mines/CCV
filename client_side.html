<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Circular Conference Visualization</title>
    <meta name="description" content="Circular Conference Visualization">
    <!-- <link rel="stylesheet" href="main.css">
    <script src="math.js" type="text/javascript"></script>
-->
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>


    <style>
        .container {
            float: left;
        }
        body {
            height: 100%;
            margin: 0px;
            padding: 0px;
        }
        html {
            height: 100%;
        }
        div.fixed-rectangle {
            width: 100%;
            height: 9%;
            background-color: #AD193D;
            box-shadow: inset 2px 0px 15px #34010e;
        }
    </style>

</head>
<body style="background-color:#e8e8e8;">

<div class="container" id="chart1">
</div>

<div class="fixed-rectangle"></div>

<p style="position: absolute; font-size:30px; font-style: italic; color: whitesmoke; text-shadow: 1.2px 1.2px 1.2px #34010e; top: 0%; left: 1%;">Conference Cycle Visualization</p>

<script>
    /*
    * visualizationHandler
    *
    * Class handles all necessary functions needed to be performed on the macro visualization
    */
    class VisualizationHandler {
        /*
         * constructor
         *
         * @params svg, document, x, y, conferences, num_confs, names, fields, colors, submission_deadlines, abstract_deadlines, decision_deadlines
         * svg: svg
         * document: used in creation of Conference object
         * x: where visualization is centered on the x axis
         * y: where visualization is centered on the y axis
         * conferences: array of Conference objects inputted into visualization on start (currently is an empty array, as we have nothing stored)
         * num_confs: number of conferences
         * names: conference names
         * fields: conference fields
         * colors: conference visualization colors
         * submission_deadlines: conference submission deadlines
         * abstract_deadlines: conference abstract deadlines
         * decision_deadlines: conference decision deadlines
         *
         * This method handles the start-up creation of our visualization. As of now it takes lists of all conference info in order using
         * separate arrays. For example, for the creation of two conferences you would have names_array = ["name_1", "name_2"],
         * fields_array = ["field_1", "field_2"], etc. If it is seen that the better way of creating conferences is using a two dimensional
         * array of conference information (i.e. [["name_1", "field_1"]["field_1", "field_2"]]), then necessary adjustments will be made.
         * If this change is made it should be noted that updating info arrays IS ESSENTIAL
         */
        constructor(svg, document, x, y, conferences, num_confs) {
            this.svg = svg;
            this.document = document;
            this.x = x;
            this.y = y;

            this.conferences = [];

            this.num_confs = num_confs;
            this.names = [];
            this.urls = [];
            this.fields = [];
            this.colors = [];
            this.submission_deadlines = [];
            this.decision_deadlines = [];
            this.conferenceStart_dates = [];
            this.conferenceEnd_dates = [];
            this.abstract_deadlines = [];
            this.locations = [];
            this.inner_radii = [];
            this.outer_radii = [];
            this.start_angles = [];
            this.end_angles = [];
            this.conf_dates_start_angles = [];
            this.conf_dates_end_angles = [];
            this.rings = [];
            this.arcs = [];
            this.abstract_arcs = [];
            this.conf_dates_arcs = [];
            this.self = this;

            // smallest conference visualization radius
            this.curr_radius = 200;

            // variables necessary for visual creation
            var spacing = 20;
            var ring_size = 3;
            var arc_size = 10;

            // populate conferences array & fill other empty arrays
            for (var i = 0; i < num_confs; i++) {
                this.names.push(conferences[i][0]);
                this.urls.push(conferences[i][1]);
                this.fields.push(conferences[i][2]);
                this.colors.push(conferences[i][3]);
                this.submission_deadlines.push(conferences[i][4]);
                this.abstract_deadlines.push(conferences[i][5]);
                this.decision_deadlines.push(conferences[i][6]);
                this.conferenceStart_dates.push(conferences[i][7]);
                this.conferenceEnd_dates.push(conferences[i][8]);
                this.locations.push(conferences[i][9]);

                // add math related translations for arc creation
                this.inner_radii.push(this.curr_radius - arc_size/2);
                this.outer_radii.push(this.curr_radius + arc_size/2);
                this.start_angles.push(((this.submission_deadlines[i])/365) * (2*Math.PI));
                this.end_angles.push(((this.decision_deadlines[i])/365) * (2*Math.PI));
                this.conf_dates_start_angles.push(((this.conferenceStart_dates[i])/365) * (2*Math.PI));
                this.conf_dates_end_angles.push(((this.conferenceEnd_dates[i])/365) * (2*Math.PI));

                // handle single conference creation
                var conf = this.addConference(svg, document, this, num_confs, this.names[i], this.urls[i], i, this.x, this.y, this.fields[i], this.colors[i],
                    this.submission_deadlines[i], this.decision_deadlines[i], this.conferenceStart_dates[i], this.conferenceEnd_dates[i],
                    this.abstract_deadlines[i], this.locations[i], this.curr_radius, this.inner_radii[i], this.outer_radii[i],
                    this.start_angles[i], this.end_angles[i], this.conf_dates_start_angles[i], this.conf_dates_end_angles[i], ring_size, arc_size, this.conferences);
            }
            console.log(this.urls);
            console.log(this.colors);
        }

        // handles addition of all conference information
        addConference(svg, document, conferences_handler, num_confs, name, conf_url, i, x, y, field, color, submission_deadline, decision_deadline,
                      conferenceStart_dates, conferenceEnd_dates, abstract_deadlines, conf_location, curr_radius, inner_radius, outer_radius,
                      start_angle, end_angle, conf_dates_start_angle, conf_dates_end_angle, ring_size, arc_size, conferences) {
            console.log("Added conference");

            console.log("addConference: ", "start & end angles", start_angle, end_angle);

            console.log(name, i, x, y, field, color, submission_deadline, decision_deadline, conferenceStart_dates, conferenceEnd_dates, abstract_deadlines, conf_location,
                curr_radius, inner_radius, outer_radius, start_angle, end_angle, conf_dates_start_angle, conf_dates_end_angle, null, null);

            var conf = new Conference(conferences_handler, name, conf_url, i, x, y, field, color, submission_deadline, decision_deadline, conferenceStart_dates, conferenceEnd_dates, abstract_deadlines, conf_location,
                curr_radius, inner_radius, outer_radius, start_angle, end_angle, conf_dates_start_angle, conf_dates_end_angle, null, null, null, null);

            console.log("addConference: ", conf.start_angle, conf.end_angle);

            console.log("addConference: ", "conf x & y:", conf.x, conf.y);

            console.log("addConference: ", "conference object:", conf);

            console.log("addConference: ", conf.conf_dates_start_angle, conf.conf_dates_end_angle);

            //Create conferences visuals and add to visualization handler arrays 'rings' and 'arcs's
            Conference.createConfVisuals(svg, document, conferences_handler, conf, conf.x, conf.y, conf.radius, conf.start_angle, conf.end_angle, conf.conf_color, conf.conf_dates_start_angle, conf.conf_dates_end_angle);

            conferences_handler.rings.push(conf.ring);
            conferences_handler.arcs.push(conf.arc);
            conferences_handler.abstract_arcs.push(conf.abstract_arc);
            conferences_handler.conf_dates_arcs.push(conf.conf_dates_arc);
            conferences_handler.conferences.push(conf);
            conferences_handler.num_confs += 1;
            // update curr_radius
            conferences_handler.curr_radius += 20;
            return conf;
        }

        static delAndUpdate(svg, document, conferences_handler, selected_index, spacing, arc_size) {
            var data_handler = new DataHandler();
            // remove ring and arc from d3 and svg
            console.log(conferences_handler, selected_index);

            conferences_handler.rings[selected_index].remove();
            conferences_handler.arcs[selected_index].remove();
            conferences_handler.abstract_arcs[selected_index].remove();
            conferences_handler.conf_dates_arcs[selected_index].remove();

            console.log(conferences_handler.arcs, conferences_handler.rings);

            // check if you need to update the visualization
            if (conferences_handler.conferences[selected_index].conf_index < (conferences_handler.num_confs - 1)) {
                console.log("Needs updating");

                for (var i = selected_index+1; i < conferences_handler.num_confs; i++) {
                    console.log("Currently updating", i);

                    var conference = conferences_handler.conferences[i];
                    console.log(conference);
                    conference.radius -= 20;
                    //conference.start_angle =



                    console.log("asdasdsdasdasd",conference);

                    //update ring
                    conference.conf_index -= 1;
                    console.log(conferences_handler.rings[i]);
                    conferences_handler.rings[i].attr("r", conference.radius);

                    //update arc
                    // 1) remove current arc
                    conferences_handler.arcs[i].remove();
                    conferences_handler.arcs[i] = null;
                    // 2) create new, updated arc and re-add to conf object
                    conferences_handler.arcs[i] = Conference.createConfArc(svg, document, conferences_handler, conference, conference.x, conference.y, conference.radius,
                        conference.start_angle, conference.end_angle, conference.conf_color, arc_size);


                    //update abstract arc
                    // 1) remove current arc
                    conferences_handler.abstract_arcs[i].remove();
                    conferences_handler.abstract_arcs[i] = null;

                    // 2) create new, updated arc and re-add to conf object
                    conferences_handler.abstract_arcs[i] = Conference.createConfAbstractsDeadlineArc(svg, document, conferences_handler,
                        data_handler, conference, conference.x, conference.y, conference.radius);


                    //update conference dates arc
                    // 1) remove current arc
                    conferences_handler.conf_dates_arcs[i].remove();
                    conferences_handler.conf_dates_arcs[i] = null;

                    // 2) create new, updated arc and re-add to conf object
                    conferences_handler.conf_dates_arcs[i] = Conference.createConfDatesArc(svg, document, conferences_handler, data_handler,
                        conference, conference.x, conference.y, conference.radius,
                        conference.conf_dates_start_angle, conference.conf_dates_end_angle);
                }
            }
            conferences_handler.conferences = conferences_handler.conferences.slice(0, selected_index).concat(conferences_handler.conferences.slice(selected_index + 1, conferences_handler.conferences.length));

            conferences_handler.names = conferences_handler.names.slice(0, selected_index).concat(conferences_handler.names.slice(selected_index + 1, conferences_handler.names.length));
            conferences_handler.fields = conferences_handler.fields.slice(0, selected_index).concat(conferences_handler.fields.slice(selected_index + 1, conferences_handler.fields.length));
            conferences_handler.colors = conferences_handler.colors.slice(0, selected_index).concat(conferences_handler.colors.slice(selected_index + 1, conferences_handler.colors.length));
            conferences_handler.submission_deadlines = conferences_handler.submission_deadlines.slice(0, selected_index).concat(conferences_handler.submission_deadlines.slice(selected_index + 1, conferences_handler.submission_deadlines.length));
            conferences_handler.decision_deadlines = conferences_handler.decision_deadlines.slice(0, selected_index).concat(conferences_handler.decision_deadlines.slice(selected_index + 1, conferences_handler.decision_deadlines.length));
            conferences_handler.conferenceStart_dates = conferences_handler.conferenceStart_dates.slice(0, selected_index).concat(conferences_handler.conferenceStart_dates.slice(selected_index + 1, conferences_handler.conferenceStart_dates.length));
            conferences_handler.conferenceEnd_dates = conferences_handler.conferenceEnd_dates.slice(0, selected_index).concat(conferences_handler.conferenceEnd_dates.slice(selected_index + 1, conferences_handler.conferenceEnd_dates.length));
            conferences_handler.abstract_deadlines = conferences_handler.abstract_deadlines.slice(0, selected_index).concat(conferences_handler.abstract_deadlines.slice(selected_index + 1, conferences_handler.abstract_deadlines.length));
            conferences_handler.locations = conferences_handler.locations.slice(0, selected_index).concat(conferences_handler.locations.slice(selected_index + 1, conferences_handler.locations.length));
            conferences_handler.inner_radii = conferences_handler.inner_radii.slice(0, selected_index).concat(conferences_handler.inner_radii.slice(selected_index + 1, conferences_handler.inner_radii.length));
            conferences_handler.outer_radii = conferences_handler.outer_radii.slice(0, selected_index).concat(conferences_handler.outer_radii.slice(selected_index + 1, conferences_handler.outer_radii.length));
            conferences_handler.start_angles = conferences_handler.start_angles.slice(0, selected_index).concat(conferences_handler.start_angles.slice(selected_index + 1, conferences_handler.start_angles.length));
            conferences_handler.end_angles = conferences_handler.end_angles.slice(0, selected_index).concat(conferences_handler.end_angles.slice(selected_index + 1, conferences_handler.end_angles.length));
            conferences_handler.rings = conferences_handler.rings.slice(0, selected_index).concat(conferences_handler.rings.slice(selected_index + 1, conferences_handler.rings.length));
            conferences_handler.arcs = conferences_handler.arcs.slice(0, selected_index).concat(conferences_handler.arcs.slice(selected_index + 1, conferences_handler.arcs.length));


            //conferences_handler.

            // return updated num_confs
            return conferences_handler.num_confs - 1;
        }

        // creates line on visualization indicating the day
        createDateLine(svg, now, x, y, r) {
            //Create data handler
            var data_handler = new DataHandler();
            //handle date conversion for finding correct angle
            var converted_date = data_handler.convertDateToNum(now);
            console.log(converted_date);
            var date_angle = (converted_date/365) * (2*Math.PI);
            console.log(date_angle);
            var newly_built_date_line = d3.svg.line.radial().angle(date_angle - (Math.PI/2)).radius(function(d) { return d; } );
            console.log(newly_built_date_line);

            //MAGIC NUMBER 15 LOOKIN REEEEAAAAAL SHIT
            var date_line = svg.append("line").attr("x1", x).attr("y1", y)
                .attr("x2", x + (r - 15)*Math.cos(date_angle - (Math.PI/2))).attr("y2", y + (r - 15)*Math.sin(date_angle - (Math.PI/2)))
                .attr("stroke-width", 2).attr("stroke", "black");
            return date_line;
        }

        // creates 12 month arcs inside the smallest conference radius to show the user how time is alloted in the visualization
        createMonthsRing(svg, x, y) {
            // how month names are displayed, change this array if you would like different names to be shown
            var months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

            // empty arrays to store the 12 created month arcs
            var month_arcs = [];
            var month_text_objs = [];

            // math portion to properly define size and spacing of arcs
            var spacing = (0.009*((2*Math.PI)/12));
            var arc_length = (((2*Math.PI)/12) - (2*spacing));
            var start_angle = spacing;
            var end_angle = arc_length - spacing;

            // begin creation of the 12 month arcs and their accompanying text
            for (var i = 0; i < 12; i++) {
                //init. and append new conference arc to svg
                var newly_built_arc = d3.svg.arc().innerRadius(170)
                    .outerRadius(190)
                    .startAngle(start_angle)
                    .endAngle(end_angle);

                var defs = svg.append("defs");

                var dropShadowFilter = defs.append('svg:filter')
                    .attr('id', 'drop-shadow')
                    .attr('filterUnits', "userSpaceOnUse")
                    .attr('width', '250%')
                    .attr('height', '250%');
                dropShadowFilter.append('svg:feGaussianBlur')
                    .attr('in', 'SourceGraphic')
                    .attr('stdDeviation', 2)
                    .attr('result', 'blur-out');
                dropShadowFilter.append('svg:feOffset')
                    .attr('in', 'color-out')
                    .attr('dx', 3)
                    .attr('dy', 3)
                    .attr('result', 'the-shadow');
                dropShadowFilter.append('svg:feBlend')
                    .attr('in', 'SourceGraphic')
                    .attr('in2', 'the-shadow')
                    .attr('mode', 'normal');


                var new_month_arc = svg.append("path").attr("id", months[i] + "_arc").attr("d", newly_built_arc).attr("transform", "translate("+x+", "+y+")").style("fill", "#AD193D");



                //var months_text_arc = svg.append("path").attr("id", "path_text_months").attr("d", "M75,300 A125,125 0 0,1 325,300").attr("fill", "none").style("stroke", "#AAAAAA");
                var months_text = svg.append("text").attr("id", months[i])
                    .attr("x", 20)   //Move the text from the start angle of the arc
                    .attr("dy", 18) //Move the text down
                    .style("font-size", 16)
                    .append("textPath").attr("xlink:href", "#"+months[i]+"_arc").style("text-anchor", "right").text(months[i]);

                // store the created text and arc (not really necessary as of now, but it's here just in case)
                month_arcs.push(new_month_arc);
                month_text_objs.push(months_text);

                // update start and end angles for the next arc to be created
                start_angle += arc_length + 2*spacing;
                end_angle += arc_length + 2*spacing;
            }
        }
    }
    //module.exports = VisualizationHandler;
</script>
<script>
    /**
     * Conference Class
     */
    class Conference {
        // constructor (must include all fields atm)
        constructor(conferences_handler, conf_name, conf_url, conf_index, x, y, conf_field, conf_color, submission_deadline, decision_deadline,
                    conferenceStart_date, conferenceEnd_date, abstract_deadline, conf_location, radius, inner_radius, outer_radius, start_angle, end_angle,
                    conf_dates_start_angle, conf_dates_end_angle, ring, arc, abstract_arc, conf_dates_arc) {
            // var. having to do with conference info.
            this.conferences_handler = conferences_handler;
            this.conf_name = conf_name;
            this.conf_url = conf_url;
            this.conf_index = conf_index;
            this.conf_field = conf_field;
            this.conf_color = conf_color;

            // var. having to do with conference vis.
            this.x = x;
            this.y = y;
            this.radius = radius;
            this.inner_radius = inner_radius;
            this.outer_radius = outer_radius;
            this.conf_dates_start_angle = conf_dates_start_angle;
            this.conf_dates_end_angle = conf_dates_end_angle;
            this.start_angle = start_angle;
            this.end_angle = end_angle;

            // var. having to do with both conf. vis. & conf. info.
            this.submission_deadline = submission_deadline;
            this.decision_deadline = decision_deadline;
            this.conferenceStart_date = conferenceStart_date;
            this.conferenceEnd_date = conferenceEnd_date;
            this.abstract_deadline = abstract_deadline;
            this.conf_location = conf_location;

            // change ring and arc size here
            this.ring_size = 3;
            this.arc_size = 10;

            // conf. shapes
            this.ring = ring;
            this.arc = arc;
            this.abstract_arc = abstract_arc;
            this.conf_dates_arc = conf_dates_arc;
        }

        /**
         * createConfRing
         * @params svg, document, conference, x, y, radius, color, ring_size
         * svg: svg object, used to add created shapes into svg
         * x, y: Cartesian coordinates of the center of circle or arc to be created on the canvas
         * radius: the radius of the circle or arc being created
         * start_angle, end_angle: used to define start and end points if arc is being created
         * color: color of circle or arc
         * ring_size: width of stroke for ring
         *
         * Creates conference ring
         */
        //Create Conference Visualizations (ring & arc), and add click handlers. TODO: SHOULD CLICK HANDLERS BE TAKEN CARE OF IN THE SAME FUNCTION???
        static createConfRing(svg, document, conferences_handler, data_handler, conference, x, y, radius, color) {
            var defs = svg.append("defs");

            var dropShadowFilter = defs.append('svg:filter')
                .attr('id', 'drop-shadow')
                .attr('filterUnits', "userSpaceOnUse")
                .attr('width', '250%')
                .attr('height', '250%');
            dropShadowFilter.append('svg:feGaussianBlur')
                .attr('in', 'SourceGraphic')
                .attr('stdDeviation', 2)
                .attr('result', 'blur-out');
            dropShadowFilter.append('svg:feOffset')
                .attr('in', 'color-out')
                .attr('dx', 3)
                .attr('dy', 3)
                .attr('result', 'the-shadow');
            dropShadowFilter.append('svg:feBlend')
                .attr('in', 'SourceGraphic')
                .attr('in2', 'the-shadow')
                .attr('mode', 'normal');



            //init. and append new conference ring to svg
            console.log("createConfRing: ", svg, document);
            var new_conf_ring = svg.append("circle").attr("cx", x).attr("cy", y)
                .attr("r", radius)
                .attr("stroke", color).attr("stroke-width", conference.ring_size)
                .style("fill", "none")
                .style("filter", "url(#drop-shadow)")
                .on("click", function() {
                    showDetails(svg, document, conferences_handler, data_handler, conference);
                    selected_conf_index = conference.conf_index;
                });


            console.log("createConfRing: ", new_conf_ring);
            return new_conf_ring;
        }

        /*
         * createConfArc
         * @params: svg, document, conference, x, y, radius, start_angle, end_angle, color, arc_size
         * svg: svg object, used to add created shapes into svg
         * x, y: Cartesian coordinates of the center of circle or arc to be created on the canvas
         * radius: the radius of the circle or arc being created
         * start_angle, end_angle: used to define start and end points if arc is being created
         * color: color of circle or arc
         * arc_size: width of stroke for arc
         * Creates Conference arc indicating all deadlines
         */
        static createConfArc(svg, document, conferences_handler, data_handler, conference, x, y, radius, start_angle, end_angle, color) {
            //init. and append new conference arc to svg
            var newly_built_arc = d3.svg.arc().innerRadius(radius - (conference.arc_size/2))
                .outerRadius(radius + (conference.arc_size/2))
                .startAngle(start_angle)
                .endAngle(end_angle);

            var defs = svg.append("defs");

            var dropShadowFilter = defs.append('svg:filter')
                .attr('id', 'drop-shadow')
                .attr('filterUnits', "userSpaceOnUse")
                .attr('width', '250%')
                .attr('height', '250%');
            dropShadowFilter.append('svg:feGaussianBlur')
                .attr('in', 'SourceGraphic')
                .attr('stdDeviation', 2)
                .attr('result', 'blur-out');
            dropShadowFilter.append('svg:feOffset')
                .attr('in', 'color-out')
                .attr('dx', 3)
                .attr('dy', 3)
                .attr('result', 'the-shadow');
            dropShadowFilter.append('svg:feBlend')
                .attr('in', 'SourceGraphic')
                .attr('in2', 'the-shadow')
                .attr('mode', 'normal');

            var new_conf_arc = svg.append("path").attr("d", newly_built_arc).attr("transform", "translate("+x+", "+y+")").style("fill", color)/*.style("filter", "url(#drop-shadow)")*/
                .on("click", function() {
                    showDetails(svg, document, conferences_handler, data_handler, conference);
                    selected_conf_index = conference.conf_index;
                });
            return new_conf_arc;
        }

        static createConfDatesArc(svg, document, conferences_handler, data_handler, conference, x, y, radius, start_angle, end_angle) {
            //init. and append new conference arc to svg
            var newly_built_arc = d3.svg.arc().innerRadius(radius - (conference.arc_size/2))
                .outerRadius(radius + (conference.arc_size/2))
                .startAngle(start_angle)
                .endAngle(end_angle);

            var new_conf_arc = svg.append("path").attr("d", newly_built_arc).attr("transform", "translate("+x+", "+y+")").style("fill", "#ffffff")
                .on("click", function() {
                    showDetails(svg, document, conferences_handler, data_handler, conference);
                    selected_conf_index = conference.conf_index;
                });
            return new_conf_arc;
        }

        static createConfAbstractsDeadlineArc(svg, document, conferences_handler, data_handler, conference, x, y, radius) {
            //init. and append new conference arc to svg
            var arc_spacing = (Math.PI/360)*2;

            var abstract_deadline_angle = (((conference.abstract_deadline)/365) * (2*Math.PI));// - arc_spacing*30;

            var newly_built_arc = d3.svg.arc().innerRadius(radius - (conference.arc_size/2))
                .outerRadius(radius + (conference.arc_size/2))
                .startAngle(abstract_deadline_angle - arc_spacing)
                .endAngle(abstract_deadline_angle + arc_spacing);

            var new_conf_arc = svg.append("path").attr("d", newly_built_arc).attr("transform", "translate("+x+", "+y+")").style("fill", "#ffffff")
                .on("click", function() {
                    showDetails(svg, document, conferences_handler, data_handler, conference);
                    selected_conf_index = conference.conf_index;
                });
            return new_conf_arc;


        }

        static createConfSubmissionDeadlineArc(svg, document, conferences_handler, data_handler, conference, x, y, radius) {
            //init. and append new conference arc to svg
            var arc_spacing = (Math.PI/360)*2;

            var abstract_deadline_angle = (((conference.submission_deadline)/365) * (2*Math.PI));// - arc_spacing*30;

            var newly_built_arc = d3.svg.arc().innerRadius(radius - (conference.arc_size/2))
                .outerRadius(radius + (conference.arc_size/2))
                .startAngle(abstract_deadline_angle - arc_spacing)
                .endAngle(abstract_deadline_angle + arc_spacing);

            var new_conf_arc = svg.append("path").attr("d", newly_built_arc).attr("transform", "translate("+x+", "+y+")").style("fill", "#ffffff")
                .on("click", function() {
                    showDetails(svg, document, conferences_handler, data_handler, conference);
                    selected_conf_index = conference.conf_index;
                });
            return new_conf_arc;
        }

        /*
         * createConfVisuals
         *
         * Uses the two previous function to handle all Conference visualization creation
         */
        static createConfVisuals(svg, document, conferences_handler, conf, x, y, radius, start_angle, end_angle, conf_color, conf_start_angle, conf_end_angle) {
            var data_handler = new DataHandler();
            console.log("createConfVisuals:", "end_angle:", end_angle);
            if (isNaN(end_angle)) {
                conf.ring = Conference.createConfRing(svg, document, conferences_handler, data_handler, conf, x, y, radius, conf_color);
                conf.abstract_arc = Conference.createConfSubmissionDeadlineArc(svg, document, conferences_handler, data_handler, conf, x, y, radius);
            } else {
                console.log("createConfVisuals: ", x, y);
                conf.ring = Conference.createConfRing(svg, document, conferences_handler, data_handler, conf, x, y, radius, conf_color);
                conf.arc = Conference.createConfArc(svg, document, conferences_handler, data_handler, conf, x, y, radius, start_angle, end_angle, conf_color);
                console.log("createConfVisuals: ", conf_start_angle, conf_end_angle);
                conf.conf_dates_arc = Conference.createConfDatesArc(svg, document, conferences_handler, data_handler, conf, x, y, radius, conf_start_angle, conf_end_angle);

                if ((conf.abstract_deadline != "") && (conf.abstract_deadline != null)) {
                    conf.abstract_arc = Conference.createConfAbstractsDeadlineArc(svg, document, conferences_handler, data_handler, conf, x, y, radius);
                }
            }
        }
    }
    //module.exports = Conference;
</script>
<script>
    /*
    * dataHandler
    *
    * Class used for any necessary data manipulation
    */
    class DataHandler {
        // no args necessary in creation of dataHandler obj as of yet
        constructor() {}

        grabConferenceData(input_file) {
            var file_lines = input_file.split('\n');

            var conf_data_and_num_confs = [];

            var conference_data = [];

            var num_confs = parseInt(file_lines[0], 10);
            var num_confs_as_url = parseInt(file_lines[1], 10);
            var num_confs_as_manual = parseInt(file_lines[2], 10);
            console.log("grabConferenceData:", num_confs, num_confs_as_url, num_confs_as_manual);

            for (var i = 3; i < 3 + num_confs_as_url; i++) {
                var split_line = file_lines[i].split(',');
                console.log(split_line.length);

                var conference = [];
                for (var k = 0; k < split_line.length; k++) {
                    if (k <= 8) {
                        conference.push(split_line[k]);
                    } else {
                        conference.push(parseInt(split_line[k], 10));
                    }
                }
                console.log("grabConferenceData:", conference);
                conference_data.push(conference);
                // ADDING URL TO CODE WILL BE HANDLED HERE AS WELL AS IN ADDING CONFERENCE WITHIN POP UP WINDOW
            }

            for (var j = 3+num_confs_as_url; j < 3+num_confs_as_url+num_confs_as_manual; j++) {
                var split_line = file_lines[j].split(',');
                console.log(split_line.length);

                var conference = [];
                for (var k = 0; k < split_line.length; k++) {
                    if ((k <= 3) || (k == 9)) {
                        conference.push(split_line[k]);
                    } else {
                        conference.push(parseInt(split_line[k], 10));
                    }
                }
                console.log("grabConferenceData:", conference);
                conference_data.push(conference);
            }
            console.log("grabConferenceData:", conference_data);
            conf_data_and_num_confs = [conference_data, conference_data.length];
            return conf_data_and_num_confs;
        }

        exportConferenceDataToUrl(conferences, data_handler) {
            var text_conferences_data = "";
            text_conferences_data += conferences.length.toString() + '%0A';

            var url_count = 0;
            for (var k = 0; k < conferences.length; k++) {
                if (conferences[k].conf_url != "") {
                    url_count += 1;
                }
            }

            text_conferences_data += url_count.toString() + '%0A';

            text_conferences_data += (conferences.length - url_count).toString() + '%0A';

            for (var i = 0; i < (conferences.length - url_count); i++) {
                var name = conferences[i].conf_name;
                var url = conferences[i].conf_url;
                var field = conferences[i].conf_field;
                var color = conferences[i].conf_color;
                var submission_deadline = conferences[i].submission_deadline;
                var abstract_deadline = conferences[i].abstract_deadline;
                var decision_deadline = conferences[i].decision_deadline;
                var conference_start_date = conferences[i].conferenceStart_date;
                var conference_end_date = conferences[i].conferenceEnd_date;
                var location = conferences[i].conf_location;
                text_conferences_data += name + '%2C' + url + '%2C'+ field + '%2C' + color + '%2C' + submission_deadline + '%2C' +
                    abstract_deadline + '%2C' + decision_deadline + '%2C' +
                    conference_start_date + '%2C' + conference_end_date + '%2C' + location + '%0A';
            }


            console.log(text_conferences_data);

            var text_file = null;
            var blob_text_conferences_data = new Blob([text_conferences_data], {type:'text/plain'});
            text_file = window.URL.createObjectURL(blob_text_conferences_data);

            console.log(text_file);

            return text_file;
        }

        exportConferenceData(conferences, data_handler) {
            var text_conferences_data = "";
            text_conferences_data += conferences.length.toString() + '\n';

            var url_count = 0;
            for (var k = 0; k < conferences.length; k++) {
                if (conferences[k].conf_url != "") {
                    console.log("dddddddd", conferences[k].conf_url);
                    url_count += 1;
                }
            }

            text_conferences_data += url_count.toString() + '\n';

            text_conferences_data += (conferences.length - url_count).toString() + '\n';

            for (var i = 0; i < (conferences.length - url_count); i++) {
                var name = conferences[i].conf_name;
                var url = conferences[i].conf_url;
                var field = conferences[i].conf_field;
                var color = conferences[i].conf_color;
                var submission_deadline = conferences[i].submission_deadline;
                var abstract_deadline = conferences[i].abstract_deadline;
                var decision_deadline = conferences[i].decision_deadline;
                var conference_start_date = conferences[i].conferenceStart_date;
                var conference_end_date = conferences[i].conferenceEnd_date;
                var location = conferences[i].conf_location;
                text_conferences_data += name + ',' + url + ','+ field + ',' + color + ',' + submission_deadline + ',' +
                    abstract_deadline + ',' + decision_deadline + ',' +
                    conference_start_date + ',' + conference_end_date + ',' + location + '\n';
            }


            console.log(text_conferences_data);

            var text_file = null;
            var blob_text_conferences_data = new Blob([text_conferences_data], {type:'text/plain'});
            text_file = window.URL.createObjectURL(blob_text_conferences_data);

            console.log(text_file);

            return text_file;
        }

        // converts date object to a number to 1 and 366 (considers leap years)
        convertDateToNum(now) {
            var start = new Date(now.getFullYear(), 0, 0);
            var diff = (now - start) + ((start.getTimezoneOffset() - now.getTimezoneOffset()) * 60 * 1000);
            var oneDay = 1000 * 60 * 60 * 24;
            var day = Math.round(diff / oneDay);
            console.log('Day of year: ' + day);
            return day;
        }

        // converts number from 1 to 366 (considering leap years) into a date object
        convertNumToDate(now, now_num) {
            var date = new Date(now.getFullYear(), 0); // initialize a date in `year-01-01`
            return new Date(date.setDate(now_num)); // add the number of days
        }
    }
    //module.exports = DataHandler;
</script>

<script>
    // declare variable used to keep track of what conference is being looked at currently
    var selected_conf_index;

    // initialize conferences array that will hold all data about conferences
    var conferences = [];

    var port = 8000;

    function getScrapedConferenceData() {
        var text_file_conference_data = [];
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange=function() {
            console.log("server:", xmlhttp.readyState, xmlhttp.status);
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                text_file_conference_data = xmlhttp.responseText;
                console.log("server:", text_file_conference_data);
                return text_file_conference_data;
            }
            console.log("Error in server request status or state");
        };
        xmlhttp.open("GET", "http://localhost:"+port+"/getDataScraper", false);
        xmlhttp.send();
        return text_file_conference_data;
    }

    /////////////////////////// NOT DONE ////////////////////////////////////
    function returnSingleUrlData() {
        var newConference;

        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange=function() {
            console.log("server:", xmlhttp.readyState, xmlhttp.status);
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                newConference = xmlhttp.responseText;
                console.log("server:", newConference);
                return newConference;
            }
            console.log("Error in server request status or state");
        };
        xmlhttp.open("GET", "http://localhost:"+port+"/returnSingleUrlData", true);
        xmlhttp.send();
        return newConference;
    }
    function getSingleUrlData(conf_url) {
        var newConference;

        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange=function() {
            console.log("getSingleUrlData:", xmlhttp.readyState, xmlhttp.status);
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                console.log("getSingleUrlData:", "Successfully completed server put");
                newConference = returnSingleUrlData();
                return newConference;
            }
        };
        xmlhttp.open("POST", "http://localhost:"+port+"/getSingleUrlData", false);
        xmlhttp.setRequestHeader("Content-Type", "text/plain");
        console.log(conf_url);
        xmlhttp.send(conf_url);
        return newConference;
    }


    function getRandomColor() {
        var letters = '0123456789ABCDEF';
        var color = '#';
        for (var i = 0; i < 6; i++) {
            color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
    }

    function parseDate(s) {
        var b = s.split(/\D/);
        return new Date(b[0], --b[1], b[2]);
    }

    function showDetails(svg, document, conferences_handler, data_handler, conference) {
        // create Date obj
        var now = new Date();

        // new elements are added dynamically on conference visualization click. This means that objects
        // need to be deleted and re-added each time a new conference is clicked. This array and for loop
        //
        // handles conference descriptive element deletions
        var details_element_ids = ["conferenceName", "mainParagraph"];
        for (var i = 0; i < details_element_ids.length; i++) {
            if (document.getElementById(details_element_ids[i])){
                var elem = document.getElementById(details_element_ids[i]);
                elem.remove();
            }
        }

        //create a new container that will appear on the left side of the screen
        var container2 = document.createElement("div");
        container2.setAttribute("style","float: left;");
        document.body.appendChild(container2);

        // Header element, will contain Conference Name
        var h1 = document.createElement('h1');
        h1.id = "conferenceName";
        h1.textContent = conference.conf_name;
        h1.style.color = conference.conf_color;
        h1.style.borderBottom = "solid #AD193D";
        h1.style.textShadow = "1px 1px 1px #000000";
        var left = document.clientWidth/2;
        var top = document.clientHeight/2;
        //h1.style.left = left;
        //h1.style.top = top;
        //h1.setAttribute("style", "position: left; z-index: 1; left: "+left+"; top: "+top+"; width:200px; height:20px;");
        //h1.style.zIndex = 1;
        container2.appendChild(h1);
        //container2.appendChild(h1);

        // Paragraph element, unknown what this will contain
        var p1 = document.createElement('p1');
        p1.id = "mainParagraph";
        p1.setAttribute("style", "white-space: pre; position: absolute; font-size:20px; z-index: 1; left: "+left+"; top: "+top+"; width:710px; height:275px;");
        p1.textContent = "Conference Topic: " + conference.conf_field + "\r\nLocation: " + conference.conf_location + "\r\nSubmission Deadline: " +
            data_handler.convertNumToDate(new Date(), conference.submission_deadline).toDateString() + "\r\nAbstract Deadline: " +
            data_handler.convertNumToDate(new Date(), conference.abstract_deadline).toDateString() + "\r\nFinal Version Due: " +
            data_handler.convertNumToDate(new Date(), conference.decision_deadline).toDateString();
        p1.setAttribute('class', 'note');
        p1.setAttribute('vertical-align', 'baseline');
        p1.style.border = "thick solid #F3EBCE";
        p1.style.backgroundColor = "linen";
        p1.style.borderBottomWidth = "6px";
        p1.style.borderRightWidth = "5px";
        p1.style.borderRightColor = "#e3d8c6";
        p1.style.borderBottomColor = "#e3d8c6";
        container2.appendChild(p1);
    }

    /*
     * main function call
     */
        function init() {
            //svg creation
            var svg_width = document.body.clientWidth / 2;
            var svg_height = document.body.clientHeight;
            var svg = d3.select("#chart1").append("svg").attr("width", svg_width)
                                                     .attr("height", svg_height);
            var returnString = returnConfString();
            console.log(returnString);

            // dataHandler object for any functions having to do with data handling (self explanatory)
            data_handler = new DataHandler();

            console.log("Successfully created data handler: ", data_handler);

                    // handle grabbing file and populating conferences array with necessary data
                    var finished_processing_data = false;

                    confs_and_num_confs = data_handler.grabConferenceData(returnString);
                    conferences = confs_and_num_confs[0];
                    num_confs = confs_and_num_confs[1];

                    finished_processing_data = true;

                    //INITIALIZATION OF VISUALIZATION
                    //create conferences & their visuals and add all info to conferences_handler object
                    var conferences_handler = new VisualizationHandler(svg, document, svg_width/2, svg_height/2, conferences, num_confs);
                    console.log("Successfully created conferences_handler: ", conferences_handler);

                    //create months ring
                    conferences_handler.createMonthsRing(svg, conferences_handler.x, conferences_handler.y);

                    //create date line
                    var now = new Date();
                    conferences_handler.createDateLine(svg, now, conferences_handler.x, conferences_handler.y, conferences_handler.curr_radius);

                    //handle onclick event for enterFields button (if 10 or more conferences made do not allow creation of another)
                    if (conferences_handler.num_confs >= 10) {
                        console.log("Maximum number of conferences allowed has been reached. " +
                                    "Please delete a conference before adding a new one.");
                    } else {
                        var button_enter_fields = document.getElementById("buttonEnterFields");
                        button_enter_fields.onclick = function () {
                            var color = "#AD193D";
                            var conference_info = enterFields(svg, document, conferences_handler, color);
                        };
                    }

                    //handle onclick event for exportData button
                    var button_export_data = document.getElementById("buttonExportConferenceData");
                    button_export_data.onclick = function() {
                        var download_link = document.getElementById("downloadlink");
                        download_link.href = data_handler.exportConferenceData(conferences_handler.conferences, data_handler);
                        download_link.style.display = 'block';
                    };

            var button_get_data = document.getElementById("buttonGetData");
            button_get_data.onclick = function() {
                text_file_conference_data = getScrapedConferenceData();
                console.log("buttonGetData:", text_file_conference_data);
                confs_and_num_confs = data_handler.grabConferenceData(text_file_conference_data);
                conferences = confs_and_num_confs[0];
                num_confs = confs_and_num_confs[1];
                conferences_handler = new VisualizationHandler(svg, document, svg_width/2, svg_height/2, conferences, num_confs);
            };

            // conference temp. variables
            // having to do with creating visual aspect of conference
            var num_confs = 3;

            // UNDER CONSTRUCTION
            // STILL NEED TO REMOVE CONFERENCE FROM conferences, AND CHECK IF I NEED TO DO ANYTHING ELSE FOR DELETION
            //num_confs = Conference.delAndUpdateConfVis(svg, conferences[2], num_confs, spacing, conferences, document, arc_size);
        }

        //calls main function (init)
        $(document).ready(function() {
            console.log("Start");
            init();
        });

    </script>


</body>
</html>
